// Bach's Initialization Script

/open https://github.com/sormuras/bach/raw/releases/16/boot

var bach = Path.of("bach")
if (Files.notExists(bach)) {
  System.out.println();
  System.out.println("Generate bach launch script");

  Files.writeString(bach,
    """
    #!/usr/bin/env bash

    if [[ $1 != 'init' ]]; then
      java --module-path .bach/cache --module com.github.sormuras.bach "$@"
    else
      rm -f .bach/cache/com.github.sormuras.bach@*.jar
      jshell -R-Dreboot -R-Dversion="${2:-16-ea}" https://github.com/sormuras/bach/raw/releases/16/init
    fi
    """).toFile().setExecutable(true);

  Files.writeString(Path.of("bach.bat"),
    """
    @ECHO OFF

    IF [%1]==[init] GOTO INIT

    java --module-path .bach\\cache --module com.github.sormuras.bach %*

    GOTO END

    :INIT
    del .bach\\cache\\com.github.sormuras.bach@*.jar >nul 2>&1
    SETLOCAL
    IF [%2]==[] ( SET tag=16-ea ) ELSE ( SET tag=%2 )
    jshell -R-Dreboot -R-Dversion=%tag% https://github.com/sormuras/bach/raw/releases/16/init
    ENDLOCAL

    :END
    """);
}

com.github.sormuras.bach.Main.printUsageInstructions(System.out)

System.out.println(
  """

  Bach initialized.

  bach [ACTION [ARGS...]]
      Launch Bach's main program handling the specified action and passing
      optional arguments to the action handler.

  bach init [VERSION]
      Update Bach to the specified version. If no version argument is given
      an early-access version of Bach is downloaded and cached.

  Have fun! https://github.com/sponsors/sormuras (-:
  """
)

/exit
